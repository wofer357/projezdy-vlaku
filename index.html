<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Odjezdy Vlaků</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            color: #1f2937;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="app" class="max-w-4xl mx-auto bg-white p-6 md:p-10 rounded-xl shadow-2xl">
        <h1 class="text-3xl font-bold mb-6 text-gray-800 border-b-2 pb-2 border-indigo-200">
            Aktuální odjezdy vlaků
        </h1>

        <!-- Vstup pro simulaci času/data -->
        <div class="mb-6 p-4 border rounded-lg bg-indigo-50">
            <h2 class="text-xl font-semibold mb-3 text-indigo-700">Nastavení simulace času</h2>
            <div class="flex flex-col sm:flex-row gap-4">
                <div class="flex-grow">
                    <label for="date-input" class="block text-sm font-medium text-gray-700">Datum:</label>
                    <input type="date" id="date-input" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2" />
                </div>
                <div class="flex-grow">
                    <label for="time-input" class="block text-sm font-medium text-gray-700">Čas (HH:MM):</label>
                    <input type="time" id="time-input" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2" />
                </div>
            </div>
            <button id="apply-time-btn" class="mt-4 w-full sm:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-150">
                Použít simulovaný čas
            </button>
            <p id="current-info" class="mt-3 text-sm text-gray-600">Aktuální datum/čas: Načítám...</p>
        </div>

        <div id="schedule-container" class="mt-8">
            <div id="error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
                <strong class="font-bold">Chyba!</strong>
                <span id="error-text" class="block sm:inline">Při zpracování dat došlo k chybě.</span>
            </div>
            <div id="schedule-output">
                <!-- Zde se vykreslí tabulka -->
            </div>
        </div>

        <h2 class="text-2xl font-bold mt-10 mb-4 text-gray-800">Vysvětlení symbolů</h2>
        <ul class="list-disc list-inside text-gray-600 space-y-1">
            <li>Dny 1-5: Pondělí až Pátek (Pracovní dny)</li>
            <li>Den 6: Sobota</li>
            <li>Den 7: Neděle</li>
            <li>Svátek: Státní svátek</li>
            <li>`x`: Vlak jede v daný den</li>
            <li>Prázdná buňka: Vlak v daný den nejede</li>
        </ul>
    </div>

    <!-- CSV Data - Upraveno dle požadavků -->
    <script id="csv-data" type="text/csv">
Čas,Směr,Vlak,1,2,3,4,5,6,7,Svátek
0.49,Dejvice,9848,x,x,x,x,x,x,x,x
4.49,Výstav.,9851,x,x,x,x,x,x,x,x
4.59,Výstav.,19731,x,x,x,x,x,x,x,x
5.21,Dejvice,9800,x,x,x,x,x
5.24,Výstav.,9853,,,,,,x,x,x
5.3,Výstav.,9855,x,x,x,x,x
5.33,Dejvice,9802,,,,,,x,x,x
5.58,Výstav.,9811,x,x,x,x,x
6.02,Dejvice,19732,x,x,x,x,x
6.13,Výstav.,Sp 1561,x,x,x,x,x
6.16,Dejvice,19734,,,,,,x,x,x
6.25,Výstav.,9801,x,x,x,x,x,x,x,x
6.37,Výstav.,R1231,x,x,x,x,x,x
6.4,Dejvice,9810,x,x,x,x,x
6.58,Výstav.,9803,x,x,x,x,x,x,x,x
7.0,Dejvice,19738,,,,,,x,x,x
7.13,Výstav.,9857,x,x,x,x,x
7.21,Dejvice,Sp 1560,x,x,x,x,x
7.24,Výstav.,R1233,x,x,x,x,x
7.37,Výstav.,9805,x,x,x,x,x,x,x,x
7.4,Dejvice,9804,x,x,x,x,x
7.58,Výstav.,9813,x,x,x,x,x
8.0,Dejvice,19740,x,x,x,x,x
8.13,Výstav.,Sp 1563,x,x,x,x,x
8.21,Dejvice,9806,x,x,x,x,x,x,x,x
8.24,Výstav.,R1235,x,x,x,x,x,x
8.37,Výstav.,9807,x,x,x,x,x,x,x,x
8.4,Dejvice,9812,x,x,x,x,x
9.0,Dejvice,19742,x,x,x,x,x
9.13,Výstav.,9859,x,x,x,x,x
9.21,Dejvice,Sp 1562,x,x,x,x,x
9.24,Výstav.,9809,x,x,x,x,x,x,x,x
9.37,Výstav.,9815,x,x,x,x,x
9.4,Dejvice,9808,x,x,x,x,x,x,x,x
9.58,Výstav.,9817,x,x,x,x,x,x,x,x
10.0,Dejvice,19744,x,x,x,x,x,x,x,x
10.13,Výstav.,9861,x,x,x,x,x,x,x,x
10.21,Dejvice,Sp 1564,x,x,x,x,x,x,x,x
10.24,Výstav.,9819,x,x,x,x,x,x,x,x
10.37,Výstav.,9821,x,x,x,x,x,x,x,x
10.4,Dejvice,9814,x,x,x,x,x,x,x,x
10.58,Výstav.,9823,x,x,x,x,x,x,x,x
11.0,Dejvice,19746,x,x,x,x,x,x,x,x
11.13,Výstav.,9863,x,x,x,x,x,x,x,x
11.21,Dejvice,Sp 1566,x,x,x,x,x,x,x,x
11.24,Výstav.,9825,x,x,x,x,x,x,x,x
11.37,Výstav.,9827,x,x,x,x,x,x,x,x
11.4,Dejvice,9816,x,x,x,x,x,x,x,x
11.58,Výstav.,9829,x,x,x,x,x,x,x,x
12.0,Dejvice,19748,x,x,x,x,x,x,x,x
12.13,Výstav.,9865,x,x,x,x,x,x,x,x
12.21,Dejvice,Sp 1568,x,x,x,x,x,x,x,x
12.24,Výstav.,R1237,x,x,x,x,x,x,x,x
12.37,Výstav.,9831,x,x,x,x,x,x,x,x
12.4,Dejvice,9818,x,x,x,x,x,x,x,x
12.58,Výstav.,9833,x,x,x,x,x,x,x,x
13.0,Dejvice,19750,x,x,x,x,x,x,x,x
13.13,Výstav.,9867,x,x,x,x,x,x,x,x
13.21,Dejvice,Sp 1570,x,x,x,x,x,x,x,x
13.24,Výstav.,9835,x,x,x,x,x,x,x,x
13.37,Výstav.,R1233,x,x,x,x,x,x
13.4,Dejvice,9820,x,x,x,x,x,x,x,x
13.58,Výstav.,9837,x,x,x,x,x,x,x,x
14.0,Dejvice,19752,x,x,x,x,x,x,x,x
14.13,Výstav.,9869,x,x,x,x,x,x,x,x
14.21,Dejvice,Sp 1572,x,x,x,x,x
14.24,Výstav.,9839,x,x,x,x,x,x,x,x
14.37,Výstav.,9841,x,x,x,x,x,x,x,x
14.4,Dejvice,9822,x,x,x,x,x,x,x,x
14.58,Výstav.,9843,x,x,x,x,x,x,x,x
15.0,Dejvice,19754,x,x,x,x,x,x,x,x
15.13,Výstav.,9871,x,x,x,x,x,x,x,x
15.21,Dejvice,Sp 1574,x,x,x,x,x
15.24,Výstav.,9845,x,x,x,x,x,x,x,x
15.37,Výstav.,R1235,x,x,x,x,x,x
15.4,Dejvice,9824,x,x,x,x,x,x,x,x
15.58,Výstav.,9847,x,x,x,x,x,x,x,x
16.0,Dejvice,19756,x,x,x,x,x,x,x,x
16.13,Výstav.,9873,x,x,x,x,x,x,x,x
16.21,Dejvice,Sp 1576,x,x,x,x,x
16.24,Výstav.,9849,x,x,x,x,x,x,x,x
16.37,Výstav.,9851,x,x,x,x,x,x,x,x
16.4,Dejvice,9826,x,x,x,x,x,x,x,x
16.58,Výstav.,9853,x,x,x,x,x,x,x,x
17.0,Dejvice,19758,x,x,x,x,x,x,x,x
17.13,Výstav.,9875,x,x,x,x,x,x,x,x
17.21,Dejvice,Sp 1578,x,x,x,x,x
17.24,Výstav.,9855,x,x,x,x,x,x,x,x
17.37,Výstav.,R1237,x,x,x,x,x,x,x,x
17.4,Dejvice,9828,x,x,x,x,x,x,x,x
17.58,Výstav.,9857,x,x,x,x,x,x,x,x
18.0,Dejvice,19760,x,x,x,x,x,x,x,x
18.13,Výstav.,9877,x,x,x,x,x,x,x,x
18.21,Dejvice,Sp 1580,x,x,x,x,x
18.24,Výstav.,9859,x,x,x,x,x,x,x,x
18.29,Výstav.,9837,x,x,x,x,x,x,x,x
18.4,Dejvice,9830,x,x,x,x,x,x,x,x
18.58,Výstav.,9861,x,x,x,x,x,x,x,x
19.0,Dejvice,19762,x,x,x,x,x,x,x,x
19.13,Výstav.,9879,x,x,x,x,x,x,x,x
19.21,Dejvice,Sp 1582,x,x,x,x,x
19.24,Výstav.,9863,x,x,x,x,x,x,x,x
19.37,Výstav.,9865,x,x,x,x,x,x,x,x
19.4,Dejvice,9832,x,x,x,x,x,x,x,x
19.58,Výstav.,9867,x,x,x,x,x,x,x,x
20.0,Dejvice,19764,x,x,x,x,x,x,x,x
20.13,Výstav.,9881,x,x,x,x,x,x,x,x
20.21,Dejvice,Sp 1584,x,x,x,x,x
20.24,Výstav.,9869,x,x,x,x,x,x,x,x
20.37,Výstav.,9871,x,x,x,x,x,x,x,x
20.4,Dejvice,9834,x,x,x,x,x,x,x,x
20.46,Výstav.,9899,x,x,x,x,x,x,x,x
20.58,Výstav.,9873,x,x,x,x,x,x,x,x
21.0,Dejvice,19766,x,x,x,x,x,x,x,x
21.13,Výstav.,9883,x,x,x,x,x,x,x,x
21.21,Dejvice,Sp 1586,x,x,x,x,x
21.24,Výstav.,9875,x,x,x,x,x,x,x,x
21.37,Výstav.,9877,x,x,x,x,x,x,x,x
21.4,Dejvice,9836,x,x,x,x,x,x,x,x
21.58,Výstav.,9879,x,x,x,x,x,x,x,x
22.0,Dejvice,19768,x,x,x,x,x,x,x,x
22.13,Výstav.,9885,x,x,x,x,x,x,x,x
22.21,Dejvice,Sp 1588,x,x,x,x,x
22.24,Výstav.,9881,x,x,x,x,x,x,x,x
22.37,Výstav.,9883,x,x,x,x,x,x,x,x
22.4,Dejvice,9838,x,x,x,x,x,x,x,x
22.58,Výstav.,9885,x,x,x,x,x,x,x,x
23.0,Dejvice,19770,x,x,x,x,x,x,x,x
23.13,Výstav.,9887,x,x,x,x,x,x,x,x
23.21,Dejvice,Sp 1590,x,x,x,x,x
23.24,Výstav.,9887,x,x,x,x,x,x,x,x
23.37,Výstav.,9889,x,x,x,x,x,x,x,x
23.4,Dejvice,9840,x,x,x,x,x,x,x,x
23.58,Výstav.,9891,x,x,x,x,x,x,x,x
    </script>

    <script type="module">
        // Data o státních svátcích pro rok 2025
        const STATE_HOLIDAYS_2025 = [
            "2025-01-01", "2025-04-18", "2025-04-21", "2025-05-01", 
            "2025-05-08", "2025-07-05", "2025-07-06", "2025-09-28", 
            "2025-10-28", "2025-11-17", "2025-12-24", "2025-12-25", "2025-12-26"
        ].map(d => new Date(d).toDateString());

        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            if (lines.length < 2) return [];
            const [headerLine, ...dataLines] = lines;
            const headers = headerLine.split(',').map(h => h.trim());
            const headerMap = {
                'Čas': 0, 'Směr': 1, 'Vlak': 2,
                '1': 3, '2': 4, '3': 5, '4': 6, '5': 7,
                '6': 8, '7': 9, 'Svátek': 10
            };

            return dataLines.map(line => {
                const values = line.split(',').map(v => v.trim());
                if (values.length !== headers.length) return null;
                return {
                    time: values[headerMap['Čas']],
                    direction: values[headerMap['Směr']],
                    train: values[headerMap['Vlak']],
                    days: {
                        1: values[headerMap['1']], 2: values[headerMap['2']], 3: values[headerMap['3']],
                        4: values[headerMap['4']], 5: values[headerMap['5']], 6: values[headerMap['6']],
                        7: values[headerMap['7']],
                        holiday: values[headerMap['Svátek']]
                    }
                };
            }).filter(item => item !== null);
        }

        function isHoliday(date) {
            return STATE_HOLIDAYS_2025.includes(date.toDateString());
        }

        function renderSchedule(currentTime = new Date()) {
            try {
                const csvData = document.getElementById('csv-data').textContent;
                const schedule = parseCSV(csvData);
                const outputDiv = document.getElementById('schedule-output');
                const errorDiv = document.getElementById('error-message');
                errorDiv.classList.add('hidden');

                const nowInMinutes = currentTime.getHours() * 60 + currentTime.getMinutes();
                let dayOfWeek = currentTime.getDay(); 
                const dayIndex = dayOfWeek === 0 ? 7 : dayOfWeek; 
                const isTodayHoliday = isHoliday(currentTime);

                const filteredSchedule = schedule.filter(item => {
                    const [hourStr, minuteStr] = item.time.split('.').map(s => parseInt(s));
                    if (isNaN(hourStr) || isNaN(minuteStr)) return false;
                    const departureInMinutes = hourStr * 60 + minuteStr;

                    if (departureInMinutes < nowInMinutes) return false;

                    const holidayMarker = item.days.holiday;
                    
                    // ZMĚNA LOGIKY: Pokud je svátek, rozhoduje POUZE sloupec Svátek.
                    if (isTodayHoliday) {
                        return holidayMarker === 'x';
                    }

                    // Pokud není svátek, rozhoduje den v týdnu
                    const dayMarker = item.days[dayIndex.toString()];
                    return dayMarker === 'x';
                });
                
                if (filteredSchedule.length === 0) {
                    outputDiv.innerHTML = '<p class="text-lg text-gray-500 p-4 border rounded-lg bg-yellow-50">Pro dnešní datum a čas nejsou k dispozici žádné další odjezdy.</p>';
                    return;
                }

                outputDiv.innerHTML = `
                    <div class="overflow-x-auto shadow-lg rounded-xl">
                        <table class="min-w-full divide-y divide-indigo-200">
                            <thead class="bg-indigo-600 text-white">
                                <tr>
                                    <th class="px-6 py-3 text-left text-sm font-medium uppercase tracking-wider">Čas</th>
                                    <th class="px-6 py-3 text-left text-sm font-medium uppercase tracking-wider">Směr</th>
                                    <th class="px-6 py-3 text-left text-sm font-medium uppercase tracking-wider">Vlak</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${filteredSchedule.map(item => `
                                    <tr class="hover:bg-indigo-50 transition duration-150">
                                        <td class="px-6 py-4 whitespace-nowrap font-semibold text-lg text-indigo-800">${item.time}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-gray-900">${item.direction}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-gray-500">${item.train}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;

            } catch (e) {
                console.error(e);
                document.getElementById('error-text').textContent = `Chyba: ${e.message}`;
                document.getElementById('error-message').classList.remove('hidden');
            }
        }

        function updateDisplayAndTime() {
            const dateInput = document.getElementById('date-input').value;
            const timeInput = document.getElementById('time-input').value;
            let displayTime = new Date();

            if (dateInput && timeInput) {
                displayTime = new Date(`${dateInput}T${timeInput}:00`);
            } else {
                const now = new Date();
                document.getElementById('date-input').value = now.toISOString().substring(0, 10);
                document.getElementById('time-input').value = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
                displayTime = now;
            }

            const formattedDate = displayTime.toLocaleDateString('cs-CZ', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            const formattedTime = displayTime.toLocaleTimeString('cs-CZ', { hour: '2-digit', minute: '2-digit' });
            let infoText = `Zobrazeno pro: ${formattedDate}, ${formattedTime}`;
            if (isHoliday(displayTime)) infoText += ' (Státní svátek)';
            document.getElementById('current-info').textContent = infoText;

            renderSchedule(displayTime);
        }

        document.addEventListener('DOMContentLoaded', () => {
            updateDisplayAndTime();
            document.getElementById('apply-time-btn').addEventListener('click', updateDisplayAndTime);
            setInterval(() => {
                if (!document.getElementById('date-input').value || !document.getElementById('time-input').value) {
                    updateDisplayAndTime();
                }
            }, 60000);
        });
    </script>
</body>
</html>
